# 阶段1 功能测试指南

## 测试环境

- **后端**：http://localhost:3001
- **前端**：http://localhost:3000
- **数据库**：SQLite（backend/prisma/dev.db）

---

## 测试前准备

### 1. 启动后端服务

```bash
cd backend
pnpm install
pnpm dev
```

### 2. 启动前端服务

```bash
cd frontend
pnpm install
pnpm dev
```

### 3. 确保数据库已迁移

```bash
cd backend
npx prisma db push
npx prisma generate
```

---

## 功能测试用例

### 测试1：创建总结并验证持久化

**目的**：验证总结完成后自动保存到 Summary 表

**步骤**：
1. 打开前端应用
2. 点击"总结"按钮，选择"今日总结"
3. 等待任务完成
4. 点击"查看历史"按钮
5. 验证：历史列表中应该包含刚才创建的总结

**预期结果**：
- ✅ 总结任务成功完成
- ✅ 历史列表中显示新创建的总结
- ✅ 刷新页面后总结仍然存在

---

### 测试2：查看历史总结

**目的**：验证历史总结列表功能

**步骤**：
1. 在历史总结页面
2. 检查列表显示
3. 尝试筛选功能

**预期结果**：
- ✅ 总结按年份分组显示
- ✅ 显示总结的模式、时间范围、概述
- ✅ 显示笔记数量和生成时间
- ✅ 筛选器可以正常展开/收起

---

### 测试3：筛选功能

**目的**：验证筛选功能正常工作

**步骤**：
1. 点击"筛选条件"按钮
2. 选择"周"模式
3. 验证列表更新
4. 选择"2024"年份
5. 验证列表更新
6. 点击"清除"按钮
7. 验证所有总结重新显示

**预期结果**：
- ✅ 按模式筛选正常
- ✅ 按年份筛选正常
- ✅ 筛选条件可以清除
- ✅ 列表正确更新

---

### 测试4：查看总结详情

**目的**：验证从历史中查看总结详情

**步骤**：
1. 在历史总结列表中
2. 点击某个总结的"查看"图标
3. 验证详情正确显示

**预期结果**：
- ✅ 总结详情面板正确打开
- ✅ 显示完整的总结内容
- ✅ 显示统计数据和图表
- ✅ 可以关闭详情面板

---

### 测试5：对比功能

**目的**：验证总结对比功能

**步骤**：
1. 在历史总结页面
2. 点击"对比"按钮进入对比模式
3. 选择第一个总结（点击）
4. 选择第二个总结（点击）
5. 点击"开始对比"按钮
6. 验证对比结果

**预期结果**：
- ✅ 进入对比模式后，总结卡片可选择
- ✅ 最多只能选择2个总结
- ✅ 选中的总结有视觉标识
- ✅ 对比结果正确显示差异：
  - 笔记数量变化
  - 新增成就
  - 已完成任务
  - 新增洞察
  - 情绪变化

---

### 测试6：删除总结

**目的**：验证删除功能

**步骤**：
1. 在历史总结列表中
2. 点击某个总结的"删除"图标
3. 确认删除
4. 验证列表更新

**预期结果**：
- ✅ 显示删除确认对话框
- ✅ 确认后总结从列表中移除
- ✅ 数据库中记录被删除

---

### 测试7：API 接口测试

**目的**：验证后端 API 接口正常工作

**测试接口**：

#### 7.1 获取历史总结

```bash
curl http://localhost:3001/api/summaries/history
```

**预期结果**：
```json
{
  "success": true,
  "data": [...]
}
```

#### 7.2 获取单个总结

```bash
curl http://localhost:3001/api/summaries/record/<SUMMARY_ID>
```

**预期结果**：
```json
{
  "success": true,
  "data": {
    "id": "...",
    "mode": "day",
    ...
  }
}
```

#### 7.3 对比总结

```bash
curl http://localhost:3001/api/summaries/<ID1>/compare?compareId=<ID2>
```

**预期结果**：
```json
{
  "success": true,
  "data": {
    "base": {...},
    "compare": {...},
    "differences": {...}
  }
}
```

#### 7.4 删除总结

```bash
curl -X DELETE http://localhost:3001/api/summaries/record/<SUMMARY_ID>
```

**预期结果**：
```json
{
  "success": true,
  "data": {
    "message": "Summary deleted"
  }
}
```

---

## 性能测试

### 测试8：大数据量测试

**目的**：验证系统在大量总结数据下的性能

**步骤**：
1. 创建多个总结（至少20个）
2. 打开历史总结页面
3. 测量加载时间
4. 测试筛选响应时间

**预期结果**：
- ✅ 列表加载时间 < 1秒
- ✅ 筛选响应时间 < 500ms
- ✅ UI 不会卡顿

---

## 兼容性测试

### 测试9：浏览器兼容性

**测试浏览器**：
- ✅ Chrome/Edge（最新版）
- ✅ Firefox（最新版）
- ✅ Safari（最新版）

**预期结果**：
- ✅ 所有功能正常工作
- ✅ UI 显示正确
- ✅ 无 JavaScript 错误

---

## 错误处理测试

### 测试10：网络错误处理

**目的**：验证网络错误时的处理

**步骤**：
1. 停止后端服务
2. 尝试访问历史总结
3. 验证错误提示

**预期结果**：
- ✅ 显示友好的错误提示
- ✅ 提供重试按钮
- ✅ 不会导致应用崩溃

---

## 数据一致性测试

### 测试11：数据库一致性

**目的**：验证数据库数据的一致性

**检查项**：
1. 打开数据库（backend/prisma/dev.db）
2. 检查 Summary 表
3. 验证以下内容：
   - ✅ 每个总结都有唯一的 taskId
   - ✅ JSON 字段格式正确
   - ✅ 时间字段值有效
   - ✅ 外键关联正确

---

## 回归测试

### 测试12：原有功能

**目的**：验证新增功能不影响原有功能

**测试项**：
- ✅ 创建笔记
- ✅ 编辑笔记
- ✅ 删除笔记
- ✅ 创建总结任务
- ✅ 查看总结结果
- ✅ 保存总结为笔记

**预期结果**：
- ✅ 所有原有功能正常工作

---

## 测试清单

- [ ] 测试1：创建总结并验证持久化
- [ ] 测试2：查看历史总结
- [ ] 测试3：筛选功能
- [ ] 测试4：查看总结详情
- [ ] 测试5：对比功能
- [ ] 测试6：删除总结
- [ ] 测试7：API 接口测试
- [ ] 测试8：大数据量测试
- [ ] 测试9：浏览器兼容性
- [ ] 测试10：网络错误处理
- [ ] 测试11：数据库一致性
- [ ] 测试12：原有功能

---

## 问题报告模板

如果发现问题，请按以下格式报告：

```
### 问题标题

**测试用例**：测试X

**问题描述**：
...

**复现步骤**：
1. ...
2. ...
3. ...

**预期结果**：
...

**实际结果**：
...

**环境信息**：
- 操作系统：
- 浏览器：
- 后端版本：
- 前端版本：

**截图**：（可选）
```

---

## 测试通过标准

所有测试用例必须满足以下条件才能认为阶段1完成：

1. ✅ 功能测试：所有功能正常工作
2. ✅ 性能测试：响应时间在可接受范围内
3. ✅ 兼容性测试：在主流浏览器中正常工作
4. ✅ 错误处理：错误情况得到妥善处理
5. ✅ 数据一致性：数据库数据正确且一致
6. ✅ 回归测试：原有功能不受影响

---

**文档创建时间**：2026-01-29
**最后更新时间**：2026-01-29
**测试负责人**：[待指定]
